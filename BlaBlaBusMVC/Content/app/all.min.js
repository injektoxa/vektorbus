"use strict";angular.module("VektorApp",["ngAnimate","ngRoute","ui.bootstrap","core","pdfMaker","clientDetail","clientList","clientTripList","tripList","busList","modalBus","driverList","driverCrud","citiesList","agentList","modalAgent","modalClient","reports","signUp","signIn","LocalStorageModule"]),angular.module("VektorApp").config(["$locationProvider","$routeProvider",function(e,t){e.html5Mode({enabled:!0}),t.when("/clients",{template:"<client-list></client-list>"}).when("/clients/:clientId",{template:"<client-detail></client-detail>"}).when("/trips",{template:"<trip-list></trip-list>"}).when("/buses",{template:"<bus-list></bus-list>"}).when("/cities",{template:"<cities-list></cities-list>"}).when("/signup",{template:"<sign-up></sign-up>"}).when("/login",{template:"<sign-in></sign-in>"}).when("/agents",{template:"<agent-list></agent-list>"}).when("/agentReports",{template:"<agent-reports></agent-reports>"}).when("/driverReports",{template:"<driver-reports></driver-reports>"}).otherwise("/login")}]),angular.module("VektorApp").animation(".client",function(){function e(e,t,i){if("selected"===t)return e.css({display:"block",position:"absolute",top:500,left:0}).animate({top:0},i),function(t){t&&e.stop()}}function t(e,t,i){if("selected"===t)return e.css({position:"absolute",top:0,left:0}).animate({top:-500},i),function(t){t&&e.stop()}}return{addClass:e,removeClass:t}}),angular.module("core",["core.client","core.trip","core.bus","core.city","core.driver","core.agent","core.agentReport","core.driverReport","core.clientTrip","core.authentication"]),angular.module("core").filter("checkmark",function(){return function(e){return e?"✓":"✘"}}),angular.module("core.client",["ngResource"]),angular.module("core.client").factory("Client",["$resource",function(e){return e("/api/clients/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.clientTrip",["ngResource"]),angular.module("core.clientTrip").factory("ClientTrip",["$resource",function(e){return e("/api/clientTrips/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.trip",["ngResource"]),angular.module("core.trip").factory("Trip",["$resource",function(e){return e("/api/trips/:Id",{},{query:{method:"GET",isArray:!0},get:{method:"GET",params:{Id:"id"}},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE"}})}]),angular.module("core.driver",["ngResource"]),angular.module("core.driver").factory("Driver",["$resource",function(e){return e("/api/drivers/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.bus",["ngResource"]),angular.module("core.bus").factory("Bus",["$resource",function(e){return e("/api/buses/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.city",["ngResource"]),angular.module("core.city").service("City",["$resource",function(e){return e("/api/Cities/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.agent",["ngResource"]),angular.module("core.agent").factory("Agent",["$resource",function(e){return e("/api/agents/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.agentReport",["ngResource"]),angular.module("core.agentReport").factory("AgentReport",["$resource",function(e){return e("/api/agentReports/",{},{query:{method:"GET",isArray:!0,params:{id:"@id",dateFrom:"@dateFrom",dateTo:"@dateTo"}}})}]),angular.module("core.driverReport",["ngResource"]),angular.module("core.driverReport").factory("DriverReport",["$resource",function(e){return e("/api/driverReports/",{},{query:{method:"GET",isArray:!0,params:{id:"@id",dateFrom:"@dateFrom",dateTo:"@dateTo"}}})}]),angular.module("core.authentication",[]),angular.module("core.authentication").factory("AuthService",["localStorageService","$http","$q",function(e,t,i){var n={};return n.authentication={isAuth:!1,email:""},n.saveRegistration=function(e){return n.logOut(),t.post("/api/Account/Register",e).then(function(e){return e})},n.logOut=function(){e.remove("authorizationData"),n.isAuth=!1,n.email=""},n.login=function(r){var o="grant_type=password&username="+r.email+"&password="+r.password,a=i.defer();return t.post("/token",o,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){e.set("authorizationData",{token:t.access_token,email:r.email}),n.authentication.isAuth=!0,n.authentication.email=r.email,a.resolve(t)},function(e,t){n.logOut(),a.reject(e)}),a.promise},n}]),angular.module("clientTripList",["core.clientTrip"]),angular.module("clientTripList").component("clientTripList",{templateUrl:"clientTrip-list/clientTrip-list.template.html",controller:["ClientTrip","$scope","City","Agent",function(e,t,i,n){var r=this;this.clientFilter="",this.clients=[],this.cities=i.query(),this.agents=n.query(),this.orderProp="Id",this.removeFromTrip=function(e){var i=t.$parent.$ctrl.trip.tripClients.indexOf(e);t.$parent.$ctrl.trip.tripClients.splice(i,1)},this.addToTrip=function(e){t.$parent.$ctrl.trip.tripClients.indexOf(e)===-1?t.$parent.$ctrl.trip.tripClients.push(e):console.log("This item already exists")},this.clientFilterAction=function(){r.clientFilter.length>1?e.query({filter:r.clientFilter},function(e){r.clients=e}):r.clients=[]},this.filterThrottled=_.debounce(r.clientFilterAction,500),t.$watch("$ctrl.clientFilter",r.filterThrottled),t.$on("clearClientTripsEvent",function(e,t){r.clientFilter="",r.clients=[]})}]}),angular.module("clientDetail",["ngRoute","core.client"]),angular.module("clientDetail").component("clientDetail",{templateUrl:"client-detail/client-detail.template.html",controller:["$routeParams","Client",function(e,t){var i=this;i.client=t.get({clientId:e.clientId},function(e){})}]}),angular.module("tripList",["core.trip","core.bus"]),angular.module("tripList").component("tripList",{templateUrl:"trip-list/trip-list.template.html",controller:["Trip","Bus","City","Driver","$uibModal","$scope","PdfMaker",function(e,t,i,n,r,o,a){var l=this;this.showAddTripForm=!1,this.isEditMode=!1,this.dateNow=new Date,this.trip={tripClients:[],startDate:l.dateNow,startTime:l.dateNow,endDate:l.dateNow,endTime:l.dateNow},this.trips=e.query(),this.buses=t.query(),this.cities=i.query(),this.drivers=n.query(),this.dateFormat="dd-MMM-yyyy",this.dateOptions={minDate:new Date,showWeeks:!1,startingDay:1},this.timeOptions={minuteStep:5},this.startDatePopup={opened:!1},this.startDateOpen=function(){l.startDatePopup.opened=!0},this.endDatePopup={opened:!1},this.endDateOpen=function(){l.endDatePopup.opened=!0},this.showAddForm=function(){l.showAddTripForm=!l.showAddTripForm},this.add=function(){return l.submitted=!0,0===l.trip.tripClients.length?void o.form.$setValidity("isAnyClient",!1):void(o.form.$invalid||(l.isEditMode?l.update():l.create()))},this.create=function(){l.joinTripDateAndTime(),e.add(l.trip,function(e){l.trips.push(e),l.showAddTripForm=!1,l.clearTripModel()})},this.update=function(){l.joinTripDateAndTime(),e.update({id:l.trip.id},l.trip,function(e){l.showAddTripForm=!1,l.clearTripModel()})},this.clearTripModel=function(){l.dateNow=new Date,l.isEditMode=!1,l.trip={tripClients:[],startDate:l.dateNow,startTime:l.dateNow,endDate:l.dateNow,endTime:l.dateNow},l.submitted=!1,o.form.$setPristine(),o.form.$setUntouched(),o.$broadcast("clearClientTripsEvent")},this.joinTripDateAndTime=function(){l.trip.date=new Date(Date.UTC(l.trip.startDate.getFullYear(),l.trip.startDate.getMonth(),l.trip.startDate.getDate(),l.trip.startTime.getHours(),l.trip.startTime.getMinutes())),l.trip.arrivalDate=new Date(Date.UTC(l.trip.endDate.getFullYear(),l.trip.endDate.getMonth(),l.trip.endDate.getDate(),l.trip.endTime.getHours(),l.trip.endTime.getMinutes()))},this.openDriversList=function(){var e={animation:!0,backdrop:"static",size:"lg",component:"driverList",resolve:{drivers:function(){return l.drivers}}},t=r.open(e);t.result.then(function(e){l.drivers=e})},this.createPDF=function(e){for(var t=[[{text:"Имя Фамилия",style:"tableHeader"},{text:"Телефон",style:"tableHeader"},{text:"Куда",style:"tableHeader"},{text:"Откуда",style:"tableHeader"},{text:"Стоимость",style:"tableHeader"},{text:"Не выходит",style:"tableHeader"},{text:"Статус",style:"tableHeader"}]],i=0;i<e.tripClients.length;i++)t.push([e.tripClients[i].Name,e.tripClients[i].Phone,e.tripClients[i].To,e.tripClients[i].From,e.tripClients[i].Price.toString(),e.tripClients[i].IsStayInBus?"Да":"",(e.tripClients[i].HasMinorChild?"С ребенком; ":"")+(e.tripClients[i].HasDisability?"Инвалид":"")]);var n=null!=e.bus?e.bus.FriendlyName+" "+e.bus.RegistrationNumber+", ":"",r=null!=e.driver?"Водитель: "+e.driver.FullName:"",o={docDefinition:{pageOrientation:"portrait",fontSize:12,content:[{text:e.cityFrom.Name.concat(" --> ",e.cityTo.Name," ",e.date)},{text:n+r},{text:"Обязательные расходы: "+e.compulsoryExpenses},{text:"Дополнительные расходы: "+e.unexpectedExpenses+" ("+e.unexpectedExpensesComments+")"},{text:" "},{table:{headerRows:1,body:t}}]}};a.createAndDownload(o)},this.editTrip=function(e){l.isEditMode=!0,l.trip=e;var t=new Date(e.date),i=new Date(e.arrivalDate);l.trip.startDate=t,l.trip.startTime=t,l.trip.endDate=i,l.trip.endTime=i,l.showAddTripForm=!0},this.delete=function(t){var i="Вы уверены, что хотите удалить маршрут "+t.cityFrom.Name+"---->"+t.cityTo.Name+", "+t.date+"?";confirm(i)&&e.remove({id:t.id},function(e){var t=l.trips.map(function(e){return e.id}).indexOf(e.id);t>-1&&l.trips.splice(t,1)},function(e){var t="Маршрут не удален. Ошибка удаления: "+e.data.Message;alert(t)})},o.$watchCollection("$ctrl.trip.tripClients",function(e,t){e&&e.length>0&&o.form.$setValidity("isAnyClient",!0)})}]}),angular.module("driverList",["core.driver"]),angular.module("driverList").component("driverList",{templateUrl:"driver-list/driver-list.template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:["Driver","$scope","$uibModal",function(e,t,i){var n=this;n.drivers=[],n.addDriverBlockVisible=!1,n.addNewClass="",n.$onInit=function(){n.drivers=n.resolve.drivers},n.closeModal=function(){n.close({$value:n.drivers})},n.editDriver=function(e){t.$broadcast("editDriverEvent",{driver:e})},n.showAddDriverBlock=function(){n.addDriverBlockVisible=!n.addDriverBlockVisible,n.addNewClass=n.addDriverBlockVisible?"not-active":""},n.deleteDriver=function(e){t.$broadcast("deleteDriverEvent",{id:e})}}]}),angular.module("driverCrud",["core.driver"]),angular.module("driverCrud").component("driverCrud",{templateUrl:"driver-list/driver-crud/driver-crud.template.html",controller:["Driver","$scope",function(e,t){var i=this;i.driver={},i.cancel=function(){t.$parent.$ctrl.showAddDriverBlock()},i.save=function(n){i.driver=n,n.Id>0?e.update({id:n.Id},n,function(e){t.$parent.$ctrl.showAddDriverBlock(),i.driver={}}):e.add(n,function(e){t.$parent.$ctrl.drivers.push(e),t.$parent.$ctrl.showAddDriverBlock(),i.driver={}})},i.deleteDriver=function(i){e.delete({id:i},function(e){var i=t.$parent.$ctrl.drivers.map(function(e){return e.Id}).indexOf(e.Id);i>-1&&t.$parent.$ctrl.drivers.splice(i,1)})},t.$on("deleteDriverEvent",function(e,t){i.deleteDriver(t.id)}),t.$on("editDriverEvent",function(e,n){i.driver=n.driver,t.$parent.$ctrl.showAddDriverBlock()})}]}),angular.module("modalBus",["core.bus"]),angular.module("modalBus").component("modalBus",{templateUrl:"bus-list/modal/modalBus-template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var e=this;e.$onInit=function(){e.bus=e.resolve.bus,e.bus&&e.bus.Id>0?e.headerTitle="Редактирование":e.headerTitle="Создание"},e.ok=function(){e.close({$value:e.bus})},e.cancel=function(){e.dismiss({$value:"cancel"})}}}),angular.module("busList",["core.bus"]),angular.module("busList").component("busList",{templateUrl:"bus-list/bus-list.template.html",controller:["Bus","$scope","$uibModal",function(e,t,i){var n=this;n.buses=e.query(),n.bus={};var r={animation:!0,backdrop:"static",component:"modalBus",resolve:{bus:function(){return n.bus}}};n.addBus=function(){var t=i.open(r);t.result.then(function(t){n.bus=t,e.add(t,function(e){n.buses.push(e),n.clearBus()})})},n.editBus=function(t){n.bus=t;var o=i.open(r);o.result.then(function(t){n.bus=t,e.update({id:t.Id},t,n.clearBus)},n.clearBus)},n.deleteBus=function(t){e.delete({id:t},function(e){var t=n.buses.map(function(e){return e.Id}).indexOf(e.Id);t>-1&&n.buses.splice(t,1)})},n.clearBus=function(){n.bus={}}}]}),angular.module("agentList",["core.agent"]),angular.module("agentList").component("agentList",{templateUrl:"agent-list/agent-list.template.html",controller:["Agent","$scope","$uibModal",function(e,t,i){var n=this;n.agents=e.query(),n.agent={};var r={animation:!0,backdrop:"static",component:"modalAgent",resolve:{agent:function(){return n.agent}}};n.addAgent=function(){var t=i.open(r);t.result.then(function(t){n.agent=t,e.add(t,function(e){n.agents.push(e),n.clearAgent()})})},n.editAgent=function(t){n.agent=t;var o=i.open(r);o.result.then(function(t){n.agent=t,e.update({id:t.Id},t,n.clearAgent)},n.clearAgent)},n.deleteAgent=function(t){e.delete({id:t},function(e){var t=n.agents.map(function(e){return e.Id}).indexOf(e.Id);t>-1&&n.agents.splice(t,1)},function(e){var t=e.data.Message;alert(t)})},n.clearAgent=function(){n.agent={}}}]}),angular.module("modalAgent",["core.agent"]),angular.module("modalAgent").component("modalAgent",{templateUrl:"agent-list/modal/modalAgent-template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var e=this;e.$onInit=function(){e.agent=e.resolve.agent,e.agent&&e.agent.Id>0?e.headerTitle="Редактирование":e.headerTitle="Создание"},e.ok=function(){e.close({$value:e.agent})},e.cancel=function(){e.dismiss({$value:"cancel"})}}}),angular.module("reports",[]),angular.module("reports").component("agentReports",{templateUrl:"reports/agent-reports.template.html",controller:["Agent","AgentReport","$filter",function(e,t,i){var n=this;n.agents=e.query(),n.agent={},n.dateTimeFormat="dd/MM/yyyy",n.dateFrom=new Date,n.dateTo=new Date,n.dateOptions={showWeeks:!1,startingDay:0,maxDate:new Date},n.reports=[],n.reportTitle="",n.totalTitle="",n.totalPrice="",n.startDatePopup={opened:!1},n.startDateOpen=function(){n.startDatePopup.opened=!0},n.endDatePopup={opened:!1},n.endDateOpen=function(){n.endDatePopup.opened=!0},n.onGetReports=function(e){n.reports=e,n.reportTitle="Отчет по агенту "+n.agent.FullName,n.totalTitle="Итого за период с "+i("date")(n.dateFrom,"yyyy-MM-dd")+" по "+i("date")(n.dateTo,"yyyy-MM-dd")+": ",n.totalPrice=0;for(var t=0;t<e.length;t++)n.totalPrice+=e[t].AgentCompensation},n.createReport=function(){n.reportTitle="",n.totalTitle="",n.totalPrice="";var e={id:n.agent.Id,dateFrom:i("date")(n.dateFrom,"yyyy-MM-dd"),dateTo:i("date")(n.dateTo,"yyyy-MM-dd")};t.query(e,n.onGetReports)}}]}),angular.module("reports").component("driverReports",{templateUrl:"reports/driver-reports.template.html",controller:["Driver","DriverReport","$filter",function(e,t,i){var n=this;n.drivers=e.query(),n.driver={},n.dateTimeFormat="dd/MM/yyyy",n.dateFrom=new Date,n.dateTo=new Date,n.dateOptions={showWeeks:!1,startingDay:0,maxDate:new Date},n.reports=[],n.reportTitle="",n.totalTitle="",n.totalPrice="",n.startDatePopup={opened:!1},n.startDateOpen=function(){n.startDatePopup.opened=!0},n.endDatePopup={opened:!1},n.endDateOpen=function(){n.endDatePopup.opened=!0},n.onGetReports=function(e){n.reports=e,n.reportTitle="Отчет по водителю "+n.driver.FullName,n.totalTitle="Итого за период с "+i("date")(n.dateFrom,"yyyy-MM-dd")+" по "+i("date")(n.dateTo,"yyyy-MM-dd")+": ",n.totalPrice=0;for(var t=0;t<e.length;t++)n.totalPrice+=e[t].CompulsoryExpenses,null!=e[t].UnexpectedExpenses&&(n.totalPrice+=e[t].UnexpectedExpenses)},n.createReport=function(){n.reportTitle="",n.totalTitle="",n.totalPrice="";var e={id:n.driver.Id,dateFrom:i("date")(n.dateFrom,"yyyy-MM-dd"),dateTo:i("date")(n.dateTo,"yyyy-MM-dd")};t.query(e,n.onGetReports)}}]}),angular.module("clientList",["core.client"]),angular.module("clientList").component("clientList",{templateUrl:"client-list/client-list.template.html",controller:["Client","Trip","$scope","$uibModal",function(e,t,i,n){var r=this;r.clients=e.query(),r.client={};var o={animation:!0,backdrop:"static",component:"modalClient",resolve:{client:function(){return r.client}}};r.addClient=function(){var t=n.open(o);t.result.then(function(t){r.client=t,e.add(t,function(e){r.clients.push(e),r.clearClient()})})},r.editClient=function(t){r.client=t;var i=n.open(o);i.result.then(function(t){r.client=t,e.update({id:t.Id},t,r.clearClient)},r.clearClient)},r.deleteClient=function(t){e.delete({id:t},function(e){var t=r.clients.map(function(e){return e.Id}).indexOf(e.Id);t>-1&&r.clients.splice(t,1)})},r.clientInfo=function(e){t.query({clientId:e.Id},function(t){var i={animation:!0,backdrop:"static",component:"modalClientTrips",size:"lg",resolve:{info:function(){return{client:e,trips:t}}}};n.open(i)})},r.clearClient=function(){r.client={}}}]}),angular.module("modalClient",["core.client"]),angular.module("modalClient").component("modalClient",{templateUrl:"client-list/modal/modalClient-template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var e=this;e.$onInit=function(){e.client=e.resolve.client,e.client&&e.client.Id>0?e.headerTitle="Редактирование":e.headerTitle="Создание"},e.ok=function(){e.close({$value:e.client})},e.cancel=function(){e.dismiss({$value:"cancel"})}}}),angular.module("modalClient").component("modalClientTrips",{templateUrl:"client-list/modal/modalClientTrips-template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:["$filter",function(e){var t=this;t.trips={},t.client={},t.headerTitle="",t.$onInit=function(){t.trips=t.resolve.info.trips,t.client=t.resolve.info.client,t.headerTitle="Информация о поездках клиента "+t.client.Name},t.getClienPrice=function(i){var n=e("filter")(i,{ClientId:t.client.Id},!0);return n[0].Price},t.getClienAdditionalExpenses=function(i){var n=e("filter")(i,{ClientId:t.client.Id},!0);return n[0].AdditionalExpenses},t.cancel=function(){t.dismiss({$value:"cancel"})}}]}),angular.module("citiesList",["core.city","google.places"]),angular.module("citiesList").component("citiesList",{templateUrl:"cities-list/cities-list.template.html",controller:["City","$scope",function(e,t){var i=this;this.cities=e.query(),this.showAddCityForm=!1,this.showAddForm=function(){i.showAddCityForm=!i.showAddCityForm},t.autocompleteOptions={componentRestrictions:{country:"ukr"},types:["(cities)"]},this.saveCity=function(t){var n=t;e.add({name:t.name}),i.showAddCityForm=!1,setTimeout(function(){i.cities=e.query(),n=""},100)},this.setCityFromAutocomplete=function(e,t){i.city.name=t}}]}),angular.module("pdfMaker",[]),angular.module("pdfMaker").factory("PdfMaker",function(){return{createAndDownload:function(e){pdfMake.createPdf(e.docDefinition).download()},createAndOpen:function(e){pdfMake.createPdf(e.docDefinition).open()}}}),angular.module("signUp",["core.authentication"]),angular.module("signUp").component("signUp",{templateUrl:"authentication/signup/signup.template.html",controller:["AuthService",function(e){var t=this;this.savedSuccessfully=!1,this.message="",this.registration={email:"",password:"",confirmPassword:""},this.signUp=function(){e.saveRegistration(this.registration).then(function(e){t.savedSuccessfully=!0,t.message="User has been registered successfully, you will be redicted to login page in 2 seconds.",window.locaton.href("/login")},function(e){var i=[];for(var n in e.data.ModelState)for(var r=0;r<e.data.ModelState[n].length;r++)i.push(e.data.ModelState[n][r]);t.message=i.join("\n")})}}]}),angular.module("signIn",["core.authentication"]),angular.module("signIn").component("signIn",{templateUrl:"authentication/signin/signin.template.html",controller:["AuthService","$location",function(e,t){var i=this;e.authentication.isAuth||(e.logOut(),t.path("/login")),this.loginData={email:"",password:""},this.message="",this.login=function(){e.login(this.loginData).then(function(e){t.path("/clients")},function(e){i.message=e.data.error_description})}}]});
//# sourceMappingURL=maps/all.min.js.map
