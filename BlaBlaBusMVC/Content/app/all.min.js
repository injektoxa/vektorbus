"use strict";angular.module("VektorApp",["ngAnimate","ngRoute","ui.bootstrap","core","pdfMaker","clientDetail","clientList","clientTripList","tripList","busList","modalBus","driverList","driverCrud","citiesList","google.places","agentList","modalAgent","modalClient","reports"]),angular.module("VektorApp").config(["$locationProvider","$routeProvider",function(e,t){t.when("/clients",{template:"<client-list></client-list>"}).when("/clients/:clientId",{template:"<client-detail></client-detail>"}).when("/trips",{template:"<trip-list></trip-list>"}).when("/buses",{template:"<bus-list></bus-list>"}).when("/cities",{template:"<cities-list></cities-list>"}).when("/agents",{template:"<agent-list></agent-list>"}).when("/agentReports",{template:"<agent-reports></agent-reports>"}).when("/driverReports",{template:"<driver-reports></driver-reports>"}).otherwise("/clients")}]),angular.module("VektorApp").animation(".client",function(){function e(e,t,r){if("selected"===t)return e.css({display:"block",position:"absolute",top:500,left:0}).animate({top:0},r),function(t){t&&e.stop()}}function t(e,t,r){if("selected"===t)return e.css({position:"absolute",top:0,left:0}).animate({top:-500},r),function(t){t&&e.stop()}}return{addClass:e,removeClass:t}}),angular.module("core",["core.client","core.trip","core.bus","core.city","core.driver","core.agent","core.agentReport","core.driverReport","core.clientTrip"]),angular.module("core").filter("checkmark",function(){return function(e){return e?"✓":"✘"}}),angular.module("core.client",["ngResource"]),angular.module("core.client").factory("Client",["$resource",function(e){return e("/api/clients/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.clientTrip",["ngResource"]),angular.module("core.clientTrip").factory("ClientTrip",["$resource",function(e){return e("/api/clientTrips/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.trip",["ngResource"]),angular.module("core.trip").factory("Trip",["$resource",function(e){return e("/api/trips/:Id",{},{query:{method:"GET",isArray:!0},get:{method:"GET",params:{Id:"id"}},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE"}})}]),angular.module("core.driver",["ngResource"]),angular.module("core.driver").factory("Driver",["$resource",function(e){return e("/api/drivers/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.bus",["ngResource"]),angular.module("core.bus").factory("Bus",["$resource",function(e){return e("/api/buses/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.city",["ngResource"]),angular.module("core.city").service("City",["$resource",function(e){return e("/api/Cities/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.agent",["ngResource"]),angular.module("core.agent").factory("Agent",["$resource",function(e){return e("/api/agents/:Id",{},{query:{method:"GET",isArray:!0},add:{method:"POST"},update:{method:"PUT"},remove:{method:"DELETE",params:{Id:"id"}}})}]),angular.module("core.agentReport",["ngResource"]),angular.module("core.agentReport").factory("AgentReport",["$resource",function(e){return e("/api/agentReports/",{},{query:{method:"GET",isArray:!0,params:{id:"@id",dateFrom:"@dateFrom",dateTo:"@dateTo"}}})}]),angular.module("core.driverReport",["ngResource"]),angular.module("core.driverReport").factory("DriverReport",["$resource",function(e){return e("/api/driverReports/",{},{query:{method:"GET",isArray:!0,params:{id:"@id",dateFrom:"@dateFrom",dateTo:"@dateTo"}}})}]),angular.module("clientTripList",["core.clientTrip"]),angular.module("clientTripList").component("clientTripList",{templateUrl:"clientTrip-list/clientTrip-list.template.html",controller:["ClientTrip","$scope","City","Agent",function(e,t,r,i){var n=this;this.clientFilter="",this.clients=[],this.cities=r.query(),this.agents=i.query(),this.orderProp="Id",this.removeFromTrip=function(e){var r=t.$parent.$ctrl.trip.tripClients.indexOf(e);t.$parent.$ctrl.trip.tripClients.splice(r,1)},this.addToTrip=function(e){t.$parent.$ctrl.trip.tripClients.indexOf(e)===-1?t.$parent.$ctrl.trip.tripClients.push(e):console.log("This item already exists")},this.clientFilterAction=function(){n.clientFilter.length>1?e.query({filter:n.clientFilter},function(e){n.clients=e}):n.clients=[]},this.filterThrottled=_.debounce(n.clientFilterAction,500),t.$watch("$ctrl.clientFilter",n.filterThrottled),t.$on("clearClientTripsEvent",function(e,t){n.clientFilter="",n.clients=[]})}]}),angular.module("clientDetail",["ngRoute","core.client"]),angular.module("clientDetail").component("clientDetail",{templateUrl:"client-detail/client-detail.template.html",controller:["$routeParams","Client",function(e,t){var r=this;r.client=t.get({clientId:e.clientId},function(e){})}]}),angular.module("tripList",["core.trip","core.bus"]),angular.module("tripList").component("tripList",{templateUrl:"trip-list/trip-list.template.html",controller:["Trip","Bus","City","Driver","$uibModal","$scope","PdfMaker",function(e,t,r,i,n,o,a){var l=this;this.showAddTripForm=!1,this.isEditMode=!1,this.dateNow=new Date,this.trip={tripClients:[],startDate:l.dateNow,startTime:l.dateNow,endDate:l.dateNow,endTime:l.dateNow},this.trips=e.query(),this.buses=t.query(),this.cities=r.query(),this.drivers=i.query(),this.dateFormat="dd-MMM-yyyy",this.dateOptions={minDate:new Date,showWeeks:!1,startingDay:1},this.timeOptions={minuteStep:5},this.startDatePopup={opened:!1},this.startDateOpen=function(){l.startDatePopup.opened=!0},this.endDatePopup={opened:!1},this.endDateOpen=function(){l.endDatePopup.opened=!0},this.showAddForm=function(){l.showAddTripForm=!l.showAddTripForm},this.add=function(){return l.submitted=!0,0===l.trip.tripClients.length?void o.form.$setValidity("isAnyClient",!1):void(o.form.$invalid||(l.isEditMode?l.update():l.create()))},this.create=function(){l.joinTripDateAndTime(),e.add(l.trip,function(e){l.trips.push(e),l.showAddTripForm=!1,l.clearTripModel()})},this.update=function(){l.joinTripDateAndTime(),e.update({id:l.trip.id},l.trip,function(e){l.showAddTripForm=!1,l.clearTripModel()})},this.clearTripModel=function(){l.dateNow=new Date,l.isEditMode=!1,l.trip={tripClients:[],startDate:l.dateNow,startTime:l.dateNow,endDate:l.dateNow,endTime:l.dateNow},l.submitted=!1,o.form.$setPristine(),o.form.$setUntouched(),o.$broadcast("clearClientTripsEvent")},this.joinTripDateAndTime=function(){l.trip.date=new Date(Date.UTC(l.trip.startDate.getFullYear(),l.trip.startDate.getMonth(),l.trip.startDate.getDate(),l.trip.startTime.getHours(),l.trip.startTime.getMinutes())),l.trip.arrivalDate=new Date(Date.UTC(l.trip.endDate.getFullYear(),l.trip.endDate.getMonth(),l.trip.endDate.getDate(),l.trip.endTime.getHours(),l.trip.endTime.getMinutes()))},this.openDriversList=function(){var e={animation:!0,backdrop:"static",size:"lg",component:"driverList",resolve:{drivers:function(){return l.drivers}}},t=n.open(e);t.result.then(function(e){l.drivers=e})},this.createPDF=function(e){for(var t=[[{text:"Имя Фамилия",style:"tableHeader"},{text:"Телефон",style:"tableHeader"},{text:"Куда",style:"tableHeader"},{text:"Откуда",style:"tableHeader"},{text:"Стоимость",style:"tableHeader"},{text:"Не выходит",style:"tableHeader"},{text:"Статус",style:"tableHeader"}]],r=0;r<e.tripClients.length;r++)t.push([e.tripClients[r].Name,e.tripClients[r].Phone,e.tripClients[r].To,e.tripClients[r].From,e.tripClients[r].Price.toString(),e.tripClients[r].IsStayInBus?"Да":"",(e.tripClients[r].HasMinorChild?"С ребенком; ":"")+(e.tripClients[r].HasDisability?"Инвалид":"")]);var i=null!=e.bus?e.bus.FriendlyName+" "+e.bus.RegistrationNumber+", ":"",n=null!=e.driver?"Водитель: "+e.driver.FullName:"",o={docDefinition:{pageOrientation:"portrait",fontSize:12,content:[{text:e.cityFrom.Name.concat(" --> ",e.cityTo.Name," ",e.date)},{text:i+n},{text:"Обязательные расходы: "+e.compulsoryExpenses},{text:"Дополнительные расходы: "+e.unexpectedExpenses+" ("+e.unexpectedExpensesComments+")"},{text:" "},{table:{headerRows:1,body:t}}]}};a.createAndDownload(o)},this.editTrip=function(e){l.isEditMode=!0,l.trip=e;var t=new Date(e.date),r=new Date(e.arrivalDate);l.trip.startDate=t,l.trip.startTime=t,l.trip.endDate=r,l.trip.endTime=r,l.showAddTripForm=!0},this.delete=function(t){var r="Вы уверены, что хотите удалить маршрут "+t.cityFrom.Name+"---->"+t.cityTo.Name+", "+t.date+"?";confirm(r)&&e.remove({id:t.id},function(e){var t=l.trips.map(function(e){return e.id}).indexOf(e.id);t>-1&&l.trips.splice(t,1)},function(e){var t="Маршрут не удален. Ошибка удаления: "+e.data.Message;alert(t)})},o.$watchCollection("$ctrl.trip.tripClients",function(e,t){e&&e.length>0&&o.form.$setValidity("isAnyClient",!0)})}]}),angular.module("driverList",["core.driver"]),angular.module("driverList").component("driverList",{templateUrl:"driver-list/driver-list.template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:["Driver","$scope","$uibModal",function(e,t,r){var i=this;i.drivers=[],i.addDriverBlockVisible=!1,i.addNewClass="",i.$onInit=function(){i.drivers=i.resolve.drivers},i.closeModal=function(){i.close({$value:i.drivers})},i.editDriver=function(e){t.$broadcast("editDriverEvent",{driver:e})},i.showAddDriverBlock=function(){i.addDriverBlockVisible=!i.addDriverBlockVisible,i.addNewClass=i.addDriverBlockVisible?"not-active":""},i.deleteDriver=function(e){t.$broadcast("deleteDriverEvent",{id:e})}}]}),angular.module("driverCrud",["core.driver"]),angular.module("driverCrud").component("driverCrud",{templateUrl:"driver-list/driver-crud/driver-crud.template.html",controller:["Driver","$scope",function(e,t){var r=this;r.driver={},r.cancel=function(){t.$parent.$ctrl.showAddDriverBlock()},r.save=function(i){r.driver=i,i.Id>0?e.update({id:i.Id},i,function(e){t.$parent.$ctrl.showAddDriverBlock(),r.driver={}}):e.add(i,function(e){t.$parent.$ctrl.drivers.push(e),t.$parent.$ctrl.showAddDriverBlock(),r.driver={}})},r.deleteDriver=function(r){e.delete({id:r},function(e){var r=t.$parent.$ctrl.drivers.map(function(e){return e.Id}).indexOf(e.Id);r>-1&&t.$parent.$ctrl.drivers.splice(r,1)})},t.$on("deleteDriverEvent",function(e,t){r.deleteDriver(t.id)}),t.$on("editDriverEvent",function(e,i){r.driver=i.driver,t.$parent.$ctrl.showAddDriverBlock()})}]}),angular.module("modalBus",["core.bus"]),angular.module("modalBus").component("modalBus",{templateUrl:"bus-list/modal/modalBus-template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var e=this;e.$onInit=function(){e.bus=e.resolve.bus,e.bus&&e.bus.Id>0?e.headerTitle="Редактирование":e.headerTitle="Создание"},e.ok=function(){e.close({$value:e.bus})},e.cancel=function(){e.dismiss({$value:"cancel"})}}}),angular.module("busList",["core.bus"]),angular.module("busList").component("busList",{templateUrl:"bus-list/bus-list.template.html",controller:["Bus","$scope","$uibModal",function(e,t,r){var i=this;i.buses=e.query(),i.bus={};var n={animation:!0,backdrop:"static",component:"modalBus",resolve:{bus:function(){return i.bus}}};i.addBus=function(){var t=r.open(n);t.result.then(function(t){i.bus=t,e.add(t,function(e){i.buses.push(e),i.clearBus()})})},i.editBus=function(t){i.bus=t;var o=r.open(n);o.result.then(function(t){i.bus=t,e.update({id:t.Id},t,i.clearBus)},i.clearBus)},i.deleteBus=function(t){e.delete({id:t},function(e){var t=i.buses.map(function(e){return e.Id}).indexOf(e.Id);t>-1&&i.buses.splice(t,1)})},i.clearBus=function(){i.bus={}}}]}),angular.module("agentList",["core.agent"]),angular.module("agentList").component("agentList",{templateUrl:"agent-list/agent-list.template.html",controller:["Agent","$scope","$uibModal",function(e,t,r){var i=this;i.agents=e.query(),i.agent={};var n={animation:!0,backdrop:"static",component:"modalAgent",resolve:{agent:function(){return i.agent}}};i.addAgent=function(){var t=r.open(n);t.result.then(function(t){i.agent=t,e.add(t,function(e){i.agents.push(e),i.clearAgent()})})},i.editAgent=function(t){i.agent=t;var o=r.open(n);o.result.then(function(t){i.agent=t,e.update({id:t.Id},t,i.clearAgent)},i.clearAgent)},i.deleteAgent=function(t){e.delete({id:t},function(e){var t=i.agents.map(function(e){return e.Id}).indexOf(e.Id);t>-1&&i.agents.splice(t,1)},function(e){var t=e.data.Message;alert(t)})},i.clearAgent=function(){i.agent={}}}]}),angular.module("modalAgent",["core.agent"]),angular.module("modalAgent").component("modalAgent",{templateUrl:"agent-list/modal/modalAgent-template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var e=this;e.$onInit=function(){e.agent=e.resolve.agent,e.agent&&e.agent.Id>0?e.headerTitle="Редактирование":e.headerTitle="Создание"},e.ok=function(){e.close({$value:e.agent})},e.cancel=function(){e.dismiss({$value:"cancel"})}}}),angular.module("reports",[]),angular.module("reports").component("agentReports",{templateUrl:"reports/agent-reports.template.html",controller:["Agent","AgentReport","$filter",function(e,t,r){var i=this;i.agents=e.query(),i.agent={},i.dateTimeFormat="dd/MM/yyyy",i.dateFrom=new Date,i.dateTo=new Date,i.dateOptions={showWeeks:!1,startingDay:0,maxDate:new Date},i.reports=[],i.reportTitle="",i.totalTitle="",i.totalPrice="",i.startDatePopup={opened:!1},i.startDateOpen=function(){i.startDatePopup.opened=!0},i.endDatePopup={opened:!1},i.endDateOpen=function(){i.endDatePopup.opened=!0},i.onGetReports=function(e){i.reports=e,i.reportTitle="Отчет по агенту "+i.agent.FullName,i.totalTitle="Итого за период с "+r("date")(i.dateFrom,"yyyy-MM-dd")+" по "+r("date")(i.dateTo,"yyyy-MM-dd")+": ",i.totalPrice=0;for(var t=0;t<e.length;t++)i.totalPrice+=e[t].AgentCompensation},i.createReport=function(){i.reportTitle="",i.totalTitle="",i.totalPrice="";var e={id:i.agent.Id,dateFrom:r("date")(i.dateFrom,"yyyy-MM-dd"),dateTo:r("date")(i.dateTo,"yyyy-MM-dd")};t.query(e,i.onGetReports)}}]}),angular.module("reports").component("driverReports",{templateUrl:"reports/driver-reports.template.html",controller:["Driver","DriverReport","$filter",function(e,t,r){var i=this;i.drivers=e.query(),i.driver={},i.dateTimeFormat="dd/MM/yyyy",i.dateFrom=new Date,i.dateTo=new Date,i.dateOptions={showWeeks:!1,startingDay:0,maxDate:new Date},i.reports=[],i.reportTitle="",i.totalTitle="",i.totalPrice="",i.startDatePopup={opened:!1},i.startDateOpen=function(){i.startDatePopup.opened=!0},i.endDatePopup={opened:!1},i.endDateOpen=function(){i.endDatePopup.opened=!0},i.onGetReports=function(e){i.reports=e,i.reportTitle="Отчет по водителю "+i.driver.FullName,i.totalTitle="Итого за период с "+r("date")(i.dateFrom,"yyyy-MM-dd")+" по "+r("date")(i.dateTo,"yyyy-MM-dd")+": ",i.totalPrice=0;for(var t=0;t<e.length;t++)i.totalPrice+=e[t].CompulsoryExpenses,null!=e[t].UnexpectedExpenses&&(i.totalPrice+=e[t].UnexpectedExpenses)},i.createReport=function(){i.reportTitle="",i.totalTitle="",i.totalPrice="";var e={id:i.driver.Id,dateFrom:r("date")(i.dateFrom,"yyyy-MM-dd"),dateTo:r("date")(i.dateTo,"yyyy-MM-dd")};t.query(e,i.onGetReports)}}]}),angular.module("clientList",["core.client"]),angular.module("clientList").component("clientList",{templateUrl:"client-list/client-list.template.html",controller:["Client","Trip","$scope","$uibModal",function(e,t,r,i){var n=this;n.clients=e.query(),n.client={};var o={animation:!0,backdrop:"static",component:"modalClient",resolve:{client:function(){return n.client}}};n.addClient=function(){var t=i.open(o);t.result.then(function(t){n.client=t,e.add(t,function(e){n.clients.push(e),n.clearClient()})})},n.editClient=function(t){n.client=t;var r=i.open(o);r.result.then(function(t){n.client=t,e.update({id:t.Id},t,n.clearClient)},n.clearClient)},n.deleteClient=function(t){e.delete({id:t},function(e){var t=n.clients.map(function(e){return e.Id}).indexOf(e.Id);t>-1&&n.clients.splice(t,1)})},n.clientInfo=function(e){t.query({clientId:e.Id},function(t){var r={animation:!0,backdrop:"static",component:"modalClientTrips",size:"lg",resolve:{info:function(){return{client:e,trips:t}}}};i.open(r)})},n.clearClient=function(){n.client={}}}]}),angular.module("modalClient",["core.client"]),angular.module("modalClient").component("modalClient",{templateUrl:"client-list/modal/modalClient-template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var e=this;e.$onInit=function(){e.client=e.resolve.client,e.client&&e.client.Id>0?e.headerTitle="Редактирование":e.headerTitle="Создание"},e.ok=function(){e.close({$value:e.client})},e.cancel=function(){e.dismiss({$value:"cancel"})}}}),angular.module("modalClient").component("modalClientTrips",{templateUrl:"client-list/modal/modalClientTrips-template.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:["$filter",function(e){var t=this;t.trips={},t.client={},t.headerTitle="",t.$onInit=function(){t.trips=t.resolve.info.trips,t.client=t.resolve.info.client,t.headerTitle="Информация о поездках клиента "+t.client.Name},t.getClienPrice=function(r){var i=e("filter")(r,{ClientId:t.client.Id},!0);return i[0].Price},t.getClienAdditionalExpenses=function(r){var i=e("filter")(r,{ClientId:t.client.Id},!0);return i[0].AdditionalExpenses},t.cancel=function(){t.dismiss({$value:"cancel"})}}]}),angular.module("citiesList",["core.city","google.places"]),angular.module("citiesList").component("citiesList",{templateUrl:"cities-list/cities-list.template.html",controller:["City","$scope",function(e,t){var r=this;this.cities=e.query(),this.showAddCityForm=!1,this.showAddForm=function(){r.showAddCityForm=!r.showAddCityForm},t.autocompleteOptions={componentRestrictions:{country:"ukr"},types:["(cities)"]},this.saveCity=function(t){var i=t;e.add({name:t.name}),r.showAddCityForm=!1,setTimeout(function(){r.cities=e.query(),i=""},100)},this.setCityFromAutocomplete=function(e,t){r.city.name=t}}]}),angular.module("pdfMaker",[]),angular.module("pdfMaker").factory("PdfMaker",function(){return{createAndDownload:function(e){pdfMake.createPdf(e.docDefinition).download()},createAndOpen:function(e){pdfMake.createPdf(e.docDefinition).open()}}});
//# sourceMappingURL=maps/all.min.js.map
